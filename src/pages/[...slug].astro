---
import { getCollection } from 'astro:content';
import PostLayout from '../layouts/PostLayout.astro';

// Get all blog posts
export async function getStaticPaths() {
  const posts = await getCollection('posts');
  
  return posts.map(post => {
    // Extract the slug from the canonical URL or use the file name
    const slug = post.data.canonical 
      ? new URL(post.data.canonical).pathname.split('/').filter(Boolean).pop()
      : post.slug;
      
    return {
      params: { slug },
      props: { post },
    };
  });
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<PostLayout post={post}>
  <Content />
</PostLayout>
